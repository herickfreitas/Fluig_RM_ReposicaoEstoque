USE [corporerm_homolog]
GO

/****** Object:  UserDefinedFunction [dbo].[Fluig_Autorizadores]    Script Date: 26/04/2021 19:15:02 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO



/* funcao retorna o autorizador da Gesta da CNC, conforme o centro de custo informado. */

CREATE FUNCTION [dbo].[_Fluig_ITENS_REPOSICAO]  

( @IDMOV AS numeric(10)) 
 
RETURNS @result TABLE (NSEQITMMOV numeric(10), DESCRICAO_PRODUTO varchar(150), SALDOFISICO2 NUMERIC(15,4), SALDFISMIN NUMERIC(15,4), PONTOREPOSICAO NUMERIC(15,4), SALDOFISMAX NUMERIC(15,4))
AS

    BEGIN  
		
		insert into @result 
	
		SELECT	DISTINCT
			TITMMOV.NSEQITMMOV
		,	TPRODUTO.CODIGOPRD +' - '+ TPRODUTO.NOMEFANTASIA AS DESCRICAO_PRODUTO
		,	TPRDLOC.SALDOFISICO2
		,	TPRDLOCINFO.SALDFISMIN
		,	TPRDLOCINFO.PONTOREPOSICAO
		,	TPRDLOCINFO.SALDOFISMAX



		FROM TPRODUTO 
			JOIN TPRDLOC		ON (TPRDLOC.IDPRD=TPRODUTO.IDPRD)
			JOIN TPRDLOCINFO	ON (TPRDLOC.IDPRD=TPRDLOCINFO.IDPRD)
			JOIN TITMMOV		ON	(TPRODUTO.IDPRD=TITMMOV.IDPRD)
			JOIN TMOV			ON	(TITMMOV.IDMOV=TMOV.IDMOV)

		WHERE TMOV.IDMOV=@IDMOV
    	
		return;	

    END

GO


