USE [Corporerm_Homolog]
GO

/****** Object:  View [dbo].[_Fluig_SOLICITANTE_CHEFIA]    Script Date: 08/03/2021 10:40:41 ******/
SET ANSI_NULLS OFF
GO

SET QUOTED_IDENTIFIER OFF
GO






CREATE VIEW [dbo].[_Fluig_SOLICITANTE_CHEFIA] AS

SELECT 

	lower(P1.CODUSUARIO)	SOLICITANTE
,	lower(P2.CODUSUARIO)	CHEFIA
	
FROM PFUNC 
	JOIN PPESSOA P1	ON (PFUNC.CODPESSOA=P1.CODIGO)
	JOIN PSECAO		ON (PFUNC.CODSECAO=PSECAO.CODIGO)
	JOIN PCCUSTO	ON (PSECAO.NROCENCUSTOCONT=PCCUSTO.CODCCUSTO)
	JOIN GCCUSTO	ON (PSECAO.NROCENCUSTOCONT=GCCUSTO.CODCCUSTO)
	JOIN PPESSOA P2	ON (GCCUSTO.RESPONSAVEL=P2.CODIGO)
	
	WHERE P1.CODUSUARIO IS NOT NULL AND P2.CODUSUARIO IS NOT NULL
	AND PFUNC.CODSITUACAO <>	'D'


/*

SELECT 
		lower(P1.CODUSUARIO) SOLICITANTE 
,		lower(P2.CODUSUARIO) CHEFIA

	FROM HATENDENTE
		INNER JOIN HHIERARQUIA H ON(HATENDENTE.CODHIERARQUIA=H.CODHIERARQUIA)
		INNER JOIN PPESSOA P1 ON(HATENDENTE.CODPESSOA=P1.CODIGO)
		INNER JOIN HATENDENTE H2 ON(H.CODCHEFEHIERAR=H2.CODATENDENTE)
		INNER JOIN PPESSOA P2 ON(H2.CODPESSOA=P2.CODIGO)
		WHERE	P1.CODUSUARIO IS NOT NULL
*/		


GO

